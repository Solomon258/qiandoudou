<!--pages/script-image-detail/script-image-detail.wxml-->
<view class="container">
  <!-- å‰§æœ¬ä¿¡æ¯å¤´éƒ¨ -->
  <view class="script-header">
    <view class="script-info">
      <!-- å·¦ä¾§å›¾æ ‡ -->
      <view class="script-cover">
        <image src="{{selectedScript.coverImage}}" class="cover-image" mode="aspectFill"></image>
        <view class="follower-count">è¶…{{selectedScript.followerCount}}äººè·Ÿ</view>
      </view>
      
      <!-- å³ä¾§ä¿¡æ¯ -->
      <view class="script-details">
        <view class="script-title">{{selectedScript.title}}</view>
        <view class="script-meta">{{selectedScript.totalChapters}}é›† | å·²æ”’{{userProgress.totalAmount || 0}}å…ƒ</view>
        <view class="script-empty"></view>
        <view class="chapter-selector">
          <view wx:for="{{selectedScript.totalChapters}}" wx:key="index" 
                class="chapter-item {{currentChapter == (index + 1) ? 'active' : ''}} {{(index + 1) > (userProgress.currentChapter || 1) ? 'locked' : ''}}"
                data-chapter="{{index + 1}}" bindtap="selectChapter">
            {{index + 1}}
            <view wx:if="{{(index + 1) > (userProgress.currentChapter || 1)}}" class="lock-icon">ğŸ”’</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç« èŠ‚å†…å®¹ -->
  <view class="chapter-content" wx:if="{{chapterContent}}">
    <!-- ç« èŠ‚æ ‡é¢˜å’ŒçŠ¶æ€ -->
    <view class="chapter-header">
      <view class="chapter-title">ç¬¬{{currentChapter}}é›† {{chapterContent.title}}</view>
      <view class="chapter-status {{currentChapter < userProgress.currentChapter ? 'completed' : 'pending'}}">
        {{currentChapter < userProgress.currentChapter ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'}}
      </view>
    </view>

    <!-- å›¾ç‰‡å†…å®¹ -->
    <view class="chapter-image" wx:if="{{chapterContent.imageUrl}}">
      <image src="{{chapterContent.imageUrl}}" class="content-image" mode="aspectFit"></image>
    </view>

    <!-- æ–‡æ¡ˆå†…å®¹ -->
    <view class="chapter-text">
      {{chapterContent.content}}
    </view>

    <!-- é€‰é¡¹åŒºåŸŸ -->
    <view class="choices-section" wx:if="{{chapterContent.choicesList && chapterContent.choicesList.length > 0}}">
      <view class="choices-title">ä½ é€‰æ‹©ï¼š</view>
      <view class="choices-list">
        <view wx:for="{{chapterContent.choicesList}}" wx:key="selection" 
              class="choice-item {{selectedChoice == item.selection ? 'selected' : ''}}"
              data-choice="{{item.selection}}" bindtap="selectChoice">
          <view class="choice-text">{{item.selection}}</view>
          <view class="choice-price">Â¥{{item.cost}}</view>
        </view>
      </view>
    </view>

    <!-- è½¬å…¥æŒ‰é’® -->
    <view class="transfer-section" wx:if="{{showTransferButton}}">
      <button class="transfer-button {{transferButtonEnabled ? 'enabled' : 'disabled'}}" 
              bindtap="transferToWallet" disabled="{{!transferButtonEnabled}}">
        å‘é’±å…œå…œè½¬å…¥
      </button>
    </view>
  </view>
</view>
