<!--pages/home/home.wxml-->
<view class="container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-nav" style="height:{{navHeight}}px">
    <!-- <view class="nav-back" bindtap="onBack">ç™»å‡º</view> -->
    <view class="nav-back">
      <view class="user-icon-new" bindtap="navigateToUserSocialProfile">
        <image class="user-icon-img"
          src="/static/icon/user.svg"
          mode="aspectFit" />
      </view>
      
      <view class="notification-icon-new" bindtap="showNotifications">
          <image class="notification-icon-img" src="/static/icon/message.svg" mode="aspectFit"/>
          <view wx:if="{{unreadMessageCount > 0}}" class="unread-badge">
            <text class="unread-count">{{unreadMessageCount > 99 ? '99+' : unreadMessageCount}}</text>
          </view>
        </view>

    </view>
    <view class="nav-title">{{currentTab === 'wallet' ? 'é’±å…œå…œ' : 'å…œåœˆåœˆ'}}</view>
  </view>
  <!-- é’±å…œå…œé¡µé¢ -->
  <view wx:if="{{currentTab === 'wallet'}}" class="wallet-page">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <!-- <view class="top-nav">
      <view class="nav-left">
        <view class="back-btn" bindtap="handleLogout">
          <text class="back-arrow">â€¹</text>
        </view>
        <text class="nav-title">é’±å…œå…œ</text>
      </view>
      <view class="nav-right">
        <view class="notification-icon-new" bindtap="showNotifications">
          <image class="notification-icon-img"
            src="https://qiandoudou.oss-cn-guangzhou.aliyuncs.com/res/image/include_images/7AB14F84-3AAF-42E6-9C09-AD1AC9545E14.png"
            mode="aspectFit" />
          <view wx:if="{{unreadMessageCount > 0}}" class="unread-badge">
            <text class="unread-count">{{unreadMessageCount > 99 ? '99+' : unreadMessageCount}}</text>
          </view>
        </view>
      </view>
    </view> -->

    <!-- é’±å…œå…œåˆ—è¡¨ -->
    <view wx:if="{{wallets.length > 0}}" class="wallet-list-section">
      <view wx:for="{{wallets}}" wx:key="id" class="wallet-card" style="{{item.backgroundStyle}}"
        bindtap="handleWalletTap" data-id="{{item.id}}">
        <!-- é’±å…œå…œä¿¡æ¯ -->
        <view class="wallet-info">
          <view class="wallet-header">
            <text class="wallet-title">{{item.name || 'é’±å…œå…œ'}}</text>
            <text class="wallet-type">{{item.type === 1 ? 'ä¸ªäºº' : 'æƒ…ä¾£'}}</text>
          </view>
          <!-- åˆ†äº«æŒ‰é’® -->
          <view class="share-btn" catchtap="onWalletShare" data-wallet="{{item}}">
            <image class="share-icon" src="/static/icon/share.svg" mode="aspectFit" />
          </view>
          <view class="wallet-amount">
            <text class="amount-text">Â¥ {{item.balance || '0.00'}}</text>
          </view>

          <!-- AIä¼´ä¾£ä¿¡æ¯ï¼ˆæƒ…ä¾£é’±å…œå…œï¼‰ -->
          <view wx:if="{{item.type === 2 && item.ai_partner_name}}" class="ai-partner-info">
            <text class="partner-label">AIä¼´ä¾£ï¼š</text>
            <text class="partner-name">{{item.ai_partner_name}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ²¡æœ‰é’±å…œå…œæ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯ -->
    <view wx:if="{{wallets.length === 0 && !showWalletTypeModal}}" class="welcome-section">
      <view class="welcome-card">
        <text class="welcome-title">æ¬¢è¿æ¥åˆ°é’±å…œå…œï¼</text>
        <text class="welcome-desc">å¼€å§‹åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªé’±å…œå…œå§ï½</text>
      </view>
    </view>



    <!-- æ–°å»ºé’±å…œå…œæŒ‰é’® -->
    <view class="create-wallet-section">
      <view class="create-wallet-card" bindtap="handleCreateWallet">
        <view class="create-content">
          <text class="add-icon">+</text>
          <text class="create-text">æ–°å»ºé’±å…œå…œ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å…œåœˆåœˆé¡µé¢ -->
  <view wx:if="{{currentTab === 'social'}}" class="social-page">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <!-- <view class="social-top-nav"> -->
      <!-- <view class="nav-left" bindtap="handleBack">
        <view class="back-icon"></view>
      </view>
      <view class="nav-title">å…œåœˆåœˆ</view> -->
      <!-- <view class="nav-right">
        <view class="user-icon-new" bindtap="navigateToUserSocialProfile">
          <image class="user-icon-img" src="https://qiandoudou.oss-cn-guangzhou.aliyuncs.com/res/image/include_images/53EAEFAA-39B8-4E6C-B88C-1DB241C01C23.png" mode="aspectFit"/>
        </view>
        <view class="notification-icon-new" bindtap="showNotifications">
          <image class="notification-icon-img" src="https://qiandoudou.oss-cn-guangzhou.aliyuncs.com/res/image/include_images/7AB14F84-3AAF-42E6-9C09-AD1AC9545E14.png" mode="aspectFit"/>
          <view wx:if="{{unreadMessageCount > 0}}" class="unread-badge">
            <text class="unread-count">{{unreadMessageCount > 99 ? '99+' : unreadMessageCount}}</text>
          </view>
        </view>
      </view> -->
    <!-- </view> -->

    <!-- åŠ¨æ€åˆ—è¡¨ -->
    <scroll-view class="social-posts-scroll" scroll-y="true" bindscrolltolower="loadMorePosts">
      <view wx:if="{{posts.length === 0}}" class="social-empty-state">
        <text class="empty-icon">ğŸ’¬</text>
        <text class="empty-text">è¿˜æ²¡æœ‰åŠ¨æ€ï¼Œå¿«æ¥åˆ†äº«ä½ çš„ç†è´¢å¿ƒå¾—å§ï¼</text>
      </view>

      <view wx:for="{{posts}}" wx:key="id" class="social-post-card" bindtap="goToWalletDetail"
        data-wallet-id="{{item.wallet_id}}" data-index="{{index}}">
        <!-- åŠ¨æ€å¡ç‰‡èƒŒæ™¯æ ·å¼ -->
        <view class="post-bg" style="{{item.backgroundStyle}}"></view>

        <!-- ç²‰ä¸æ ‡ç­¾ -->
        <view class="fans-badge">ç²‰ä¸ {{item.fansCount}}</view>

        <!-- åŠ¨æ€å†…å®¹åŒºåŸŸ -->
        <view class="post-content-area">
          <!-- é’±å…œå…œä¿¡æ¯å’Œæ€»é‡‘é¢ -->
          <view class="post-main-header">
            <view class="post_title_view">
              <view class="post-title">{{item.title}}</view>
              <!-- å‚ä¸äººæ•° -->
              <view class="participants">{{item.participantCount}}äºº</view>
            </view>
            <view class="post-amount">Â¥{{item.total_amount}}</view>
          </view>

          <!-- æ ‡ç­¾å’Œæè¿° -->
          <view class="post-tags-desc">
            <text class="tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">#{{tag}}</text>
            <text class="description">{{item.description}}</text>
          </view>

          <!-- æœ€æ–°ä¸¤ç¬”è´¦å• -->
          <view class="recent-transactions">
            <view wx:for="{{item.recent_transactions}}" wx:for-item="transaction" wx:key="id" class="transaction-item">
              <view class="transaction-user-avatar">
                <text class="avatar-text">{{transaction.user_nickname.charAt(0)}}</text>
              </view>
              <view class="transaction-content">
                <text class="transaction-desc">{{transaction.user_nickname}}ï¼š{{transaction.comment}}</text>
                <text wx:if="{{transaction.amount > 0}}" class="amount-change">+Â¥{{transaction.amount}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤šæç¤º -->
      <view wx:if="{{loadingMore}}" class="loading-more">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>

      <view wx:elif="{{!hasMorePosts && posts.length > 0}}" class="no-more-data">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
      </view>
    </scroll-view>
  </view>

  <!-- åº•éƒ¨å¯¼èˆª -->
  <view class="bottom-nav">
    <view class="nav-item {{currentTab === 'wallet' ? 'active' : ''}}" bindtap="switchTab" data-tab="wallet">
      <view class="nav-icon-container">
        <image class="notification-icon-img2" wx:if="{{currentTab === 'wallet'}}" src="/static/icon/qian_active.svg"
          mode="aspectFit" />
        <image class="notification-icon-img2" wx:else src="/static/icon/qiandoudou.svg" mode="aspectFit" />
      </view>
      <text class="nav-text">é’±å…œå…œ</text>
    </view>
    <view class="nav-item {{currentTab === 'social' ? 'active' : ''}}" bindtap="switchTab" data-tab="social">
      <view class="nav-icon-container">
        <image wx:if="{{currentTab === 'social'}}" class="notification-icon-img2" src="/static/icon/douquan_active.svg"
          mode="aspectFit" />
        <image wx:else class="notification-icon-img2" src="/static/icon/douquanquan.svg" mode="aspectFit" />
      </view>
      <text class="nav-text">å…œåœˆåœˆ</text>
    </view>
  </view>

  <!-- é’±å…œå…œç±»å‹é€‰æ‹©æ¨¡æ€æ¡† -->
  <view wx:if="{{showWalletTypeModal}}" class="modal-overlay" bindtap="hideWalletTypeModal">
    <view class="wallet-type-modal" catchtap="stopPropagation">
      <!-- æ¨¡æ€æ¡†å¤´éƒ¨ -->
      <view class="modal-header">
        <view class="modal-title">
          <text>é€‰æ‹©é’±å…œå…œç”¨é€”</text>
        </view>
        <!-- åªæœ‰éé¦–æ¬¡ç”¨æˆ·æ‰æ˜¾ç¤ºå…³é—­æŒ‰é’® -->
        <view wx:if="{{!isFirstTimeUser}}" class="modal-close" bindtap="hideWalletTypeModal">
          <text class="close-icon">Ã—</text>
        </view>
      </view>

      <!-- é’±å…œå…œç±»å‹é€‰é¡¹ -->
      <view class="wallet-type-options">
        <!-- è‡ªå·±æ”’é’± -->
        <view class="wallet-type-option {{selectedWalletType === 'personal' ? 'selected' : ''}}"
          bindtap="selectWalletType" data-type="personal">
          <view class="option-icon couple">
            <image class="couple-avatar-image" src="/static/icon/gerenzan.png" mode="aspectFill"></image>
          </view>
          <view class="option-content">
            <text class="option-title">è‡ªå·±æ”’é’±</text>
            <text class="option-desc">è‡ªå·±æ”’é’±ï¼Œåˆ†ç±»ç®¡é’±ç­‰</text>
          </view>
          <view class="option-radio">
            <view class="radio-circle {{selectedWalletType === 'personal' ? 'selected' : ''}}">
              <text wx:if="{{selectedWalletType === 'personal'}}" class="check-mark">âœ“</text>
            </view>
          </view>
        </view>

        <!-- æƒ…ä¾£æ”’é’± -->
        <view class="wallet-type-option {{selectedWalletType === 'couple' ? 'selected' : ''}}"
          bindtap="selectWalletType" data-type="couple">
          <view class="option-icon couple">
            <image class="couple-avatar-image" src="/static/icon/qinglv.png" mode="aspectFill"></image>
          </view>
          <view class="option-content">
            <text class="option-title">æƒ…ä¾£æ”’é’±</text>
            <text class="option-desc">å’ŒAIä¼´ä¾£ä¸€èµ·æ”’é’±</text>
          </view>
          <view class="option-radio">
            <view class="radio-circle {{selectedWalletType === 'couple' ? 'selected' : ''}}">
              <text wx:if="{{selectedWalletType === 'couple'}}" class="check-mark">âœ“</text>
            </view>
          </view>
        </view>
        <!-- æƒ…ä¾£æ”’é’± -->
        <view class="wallet-type-option {{selectedWalletType === 'couple2' ? 'selected' : ''}}"
          bindtap="selectWalletType" data-type="couple2">
          <view class="option-icon couple">
            <image class="couple-avatar-image" src="/static/icon/dazi.png" mode="aspectFill"></image>
          </view>
          <view class="option-content">
            <text class="option-title">æ­å­æ”’é’±</text>
            <text class="option-desc">å’Œæ­å­ä¸€èµ·æ”’é’±</text>
          </view>
          <view class="option-radio">
            <view class="radio-circle {{selectedWalletType === 'couple2' ? 'selected' : ''}}">
              <text wx:if="{{selectedWalletType === 'couple2'}}" class="check-mark">âœ“</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç¡®è®¤æŒ‰é’® -->
      <view class="modal-footer">
        <button class="confirm-create-btn" bindtap="confirmCreateWallet" disabled="{{!selectedWalletType}}">
          <text class="btn-text">ç¡®è®¤æ–°å»ºé’±å…œå…œ</text>
        </button>
      </view>
    </view>
  </view>

  <!-- åˆ†äº«å¼¹çª— -->
  <share-modal show="{{showShareModal}}" shareImageUrl="{{shareImageUrl}}" bind:close="onShareModalClose"
    bind:save="onShareImageSave">
  </share-modal>
</view>