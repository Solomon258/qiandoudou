<!--pages/edit-profile/edit-profile.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="top-nav">
    <view class="nav-left" bindtap="goBack">
    </view>
    <view class="nav-title">ç¼–è¾‘è´¦å·ä¿¡æ¯</view>
    <view class="nav-right"></view>
  </view>

  <!-- å…œåœˆåœˆèº«ä»½ä¿¡æ¯ -->
  <view class="section-title">å…œåœˆåœˆèº«ä»½ä¿¡æ¯</view>
  
  <view class="info-card">
    <!-- å¤´åƒ -->
    <view class="info-item">
      <text class="item-label">å¤´åƒ</text>
      <view class="item-content">
        <view class="avatar-preview" bindtap="changeAvatar">
          <image wx:if="{{userInfo.hasCustomAvatar && userInfo.avatar}}" 
                 class="avatar-image" 
                 src="{{userInfo.avatar}}" 
                 mode="aspectFill"/>
          <text wx:else class="avatar-text">{{userInfo.nickname ? userInfo.nickname.charAt(0) : 'ç”¨'}}</text>
          <view wx:if="{{isUploadingAvatar}}" class="upload-loading">
            <view class="loading-spinner"></view>
          </view>
        </view>
        
        <!-- å¾®ä¿¡å¤´åƒé€‰æ‹©æŒ‰é’® -->
        <view class="wechat-avatar-section" wx:if="{{showWechatAvatarOption}}">
          <button class="wechat-avatar-btn" 
                  open-type="chooseAvatar" 
                  bind:chooseavatar="onChooseWechatAvatar"
                  disabled="{{isUploadingAvatar}}">
            <text class="wechat-icon">ğŸ’¬</text>
            <text class="btn-text">ä½¿ç”¨å¾®ä¿¡å¤´åƒ</text>
          </button>
        </view>
        
        <view class="arrow-icon" bindtap="changeAvatar"></view>
      </view>
    </view>
    
    <view class="divider"></view>
    
    <!-- æ˜µç§° -->
    <view class="info-item">
      <text class="item-label">æ˜µç§°</text>
      <view class="item-content">
        <view class="nickname-display" bindtap="editNickname">
          <text class="item-value">{{userInfo.nickname || 'æ˜†è™«è®°'}}</text>
        </view>
        
        <!-- å¾®ä¿¡æ˜µç§°é€‰æ‹©æŒ‰é’® -->
        <view class="wechat-nickname-section" wx:if="{{showWechatAvatarOption}}">
          <input class="wechat-nickname-input" 
                 type="nickname" 
                 placeholder="ç‚¹å‡»è·å–å¾®ä¿¡æ˜µç§°"
                 bind:input="onWechatNicknameInput"
                 disabled="{{isUpdatingNickname}}" />
        </view>
        
        <view class="arrow-icon" bindtap="editNickname"></view>
      </view>
    </view>
    
    <view class="divider"></view>
    
    <!-- æ€§åˆ« -->
    <view class="info-item" bindtap="editGender">
      <text class="item-label">æ€§åˆ«</text>
      <view class="item-content">
        <text class="item-value {{!userInfo.gender ? 'placeholder' : ''}}">{{userInfo.gender || 'å¾…å¡«å†™'}}</text>
        <view class="arrow-icon"></view>
      </view>
    </view>
  </view>

  <!-- ç®€ä»‹ -->
  <view class="info-card single-item">
    <view class="info-item" bindtap="editDescription">
      <text class="item-label">ç®€ä»‹</text>
      <view class="item-content">
        <text class="item-value">{{userInfo.description || 'æ¯100ä¸ªç²‰ä¸ï¼Œæ‰“å¡ä¸€ä¸ª5Açº§æ™¯åŒº'}}</text>
        <view class="arrow-icon"></view>
      </view>
    </view>
  </view>

  <!-- è·åŒ…åœˆèº«ä»½ä¿¡æ¯ -->
  <view class="section-title">è·åŒ…åœˆèº«ä»½ä¿¡æ¯</view>
  
  <view class="info-card">
    <!-- å…¬å¼€é’±å…œå…œåœ¨ä¸»é¡µå¯è§ -->
    <view class="info-item">
      <text class="item-label">å…¬å¼€é’±å…œå…œåœ¨ä¸»é¡µå¯è§</text>
      <view class="item-content">
        <switch class="switch-control" 
               checked="{{settings.showPublicWallets}}" 
               bindchange="onPublicWalletsToggle"/>
      </view>
    </view>
    
    <view class="divider"></view>
    
    <!-- å…³æ³¨é’±å…œå…œåœ¨ä¸»é¡µå¯è§ -->
    <view class="info-item">
      <text class="item-label">å…³æ³¨é’±å…œå…œåœ¨ä¸»é¡µå¯è§</text>
      <view class="item-content">
        <switch class="switch-control" 
               checked="{{settings.showFollowedWallets}}" 
               bindchange="onFollowedWalletsToggle"/>
      </view>
    </view>
  </view>
</view>

<!-- éšè—çš„canvasç”¨äºå›¾ç‰‡å¤„ç† -->
<canvas canvas-id="avatarCanvas" style="position: absolute; left: -9999px; top: -9999px; width: 200px; height: 200px;"></canvas>

<!-- ç¼–è¾‘å¼¹çª— -->
<view wx:if="{{showEditModal}}" class="modal-overlay" bindtap="closeEditModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">ç¼–è¾‘{{editType === 'nickname' ? 'æ˜µç§°' : editType === 'gender' ? 'æ€§åˆ«' : 'ç®€ä»‹'}}</text>
      <view class="modal-close" bindtap="closeEditModal">Ã—</view>
    </view>
    
    <view class="modal-body">
      <view wx:if="{{editType === 'nickname' || editType === 'description'}}" class="input-group">
        <input class="edit-input" 
               placeholder="{{editType === 'nickname' ? 'è¯·è¾“å…¥æ˜µç§°' : 'è¯·è¾“å…¥ç®€ä»‹'}}"
               value="{{editValue}}"
               bindinput="onEditInput"
               maxlength="{{editType === 'nickname' ? 20 : 100}}"/>
        <text class="input-counter">{{editValue.length}}/{{editType === 'nickname' ? 20 : 100}}</text>
      </view>
      
      <view wx:if="{{editType === 'gender'}}" class="gender-options">
        <view class="gender-option {{editValue === 'ç”·' ? 'selected' : ''}}" 
              bindtap="selectGender" data-gender="ç”·">
          <text>ç”·</text>
        </view>
        <view class="gender-option {{editValue === 'å¥³' ? 'selected' : ''}}" 
              bindtap="selectGender" data-gender="å¥³">
          <text>å¥³</text>
        </view>
        <view class="gender-option {{editValue === 'ä¿å¯†' ? 'selected' : ''}}" 
              bindtap="selectGender" data-gender="ä¿å¯†">
          <text>ä¿å¯†</text>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="cancel-btn" bindtap="closeEditModal">å–æ¶ˆ</button>
      <button class="confirm-btn" bindtap="confirmEdit">ç¡®å®š</button>
    </view>
  </view>
</view>
