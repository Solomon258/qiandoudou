<!--pages/login/login.wxml-->
<view class="container">
  <!-- 授权面板 -->
  <view class="auth-panel" wx:if="{{showAuthPanel}}">
    <view class="auth-content">
      <view class="logo-section">
        <view class="logo-icon">💰</view>
        <text class="logo-text">钱兜兜</text>
        <text class="logo-subtitle">和AI一起攒钱</text>
      </view>
      
      <view class="auth-title">设置你的昵称、头像</view>
      <view class="auth-desc">请设置您在钱兜兜的个人信息</view>
      
      <!-- 头像选择 -->
      <view class="avatar-section">
        <view class="avatar-preview">
          <image wx:if="{{tempAvatar}}" class="avatar-image" src="{{tempAvatar}}" mode="aspectFill"/>
          <text wx:else class="avatar-placeholder">选择头像</text>
        </view>
        <button class="choose-avatar-btn" 
                open-type="chooseAvatar" 
                bind:chooseavatar="onChooseAvatar">选择微信头像</button>
      </view>
      
      <!-- 昵称输入 -->
      <view class="nickname-section">
        <input class="nickname-input" 
               type="nickname" 
               placeholder="请输入昵称"
               value="{{tempNickname}}"
               bind:input="onNicknameInput" />
      </view>
      
      <view class="auth-buttons">
        <button class="auth-btn-primary" 
                bindtap="handleSaveProfile"
                disabled="{{!tempAvatar || !tempNickname}}">完成设置</button>
        <button class="auth-btn-secondary" bindtap="handleManualSetup">跳过</button>
      </view>
    </view>
  </view>

  <view class="login-box" wx:if="{{!showAuthPanel}}">
    <!-- Logo区域 -->
    <view class="logo-section">
      <view class="logo-icon">💰</view>
      <text class="logo-text">钱兜兜</text>
      <text class="logo-subtitle">和AI一起攒钱</text>
    </view>

    <!-- 登录方式选择 -->
    <view class="login-methods">
      <!-- 微信登录 -->
      <button class="wechat-login-btn" bindtap="handleWechatLogin" disabled="{{loading}}">
        <text class="wechat-icon">💬</text>
        <text class="login-text">{{loading && loginType === 'wechat' ? '登录中...' : '微信登录'}}</text>
      </button>

      <!-- 账号登录 -->
      <button class="phone-login-btn" bindtap="handlePhoneLogin" disabled="{{loading}}">
        <text class="phone-icon">👤</text>
        <text class="login-text">账号登录</text>
      </button>

      <!-- 注册账号 -->
      <button class="demo-login-btn" bindtap="handleRegister" disabled="{{loading}}">
        <text class="demo-icon">📝</text>
        <text class="login-text">注册账号</text>
      </button>
    </view>

    <!-- 服务协议 -->
    <view class="agreement">
      <text class="agreement-text">登录即表示同意</text>
      <text class="agreement-link" bindtap="showAgreement">《用户协议》</text>
      <text class="agreement-text">和</text>
      <text class="agreement-link" bindtap="showPrivacy">《隐私政策》</text>
    </view>
  </view>

  <!-- 登录表单模态框 -->
  <view class="modal-overlay" wx:if="{{showLoginForm}}" bindtap="hideLoginForm">
    <view class="modal-content" catchtap>
      <view class="modal-header">
        <text class="modal-title">账号登录</text>
        <text class="modal-close" bindtap="hideLoginForm">✕</text>
      </view>
      <view class="modal-body">
        <view class="input-group">
          <input class="form-input" type="text" placeholder="请输入用户名" 
                 value="{{loginForm.username}}" 
                 data-field="username" 
                 bindinput="onLoginInput" />
        </view>
        <view class="input-group">
          <input class="form-input" type="password" placeholder="请输入密码" 
                 value="{{loginForm.password}}" 
                 data-field="password" 
                 bindinput="onLoginInput" />
        </view>
        <button class="submit-btn" bindtap="submitLogin" disabled="{{loading}}">
          {{loading ? '登录中...' : '登录'}}
        </button>
      </view>
    </view>
  </view>

  <!-- 注册表单模态框 -->
  <view class="modal-overlay" wx:if="{{showRegisterForm}}" bindtap="hideRegisterForm">
    <view class="modal-content" catchtap>
      <view class="modal-header">
        <text class="modal-title">注册账号</text>
        <text class="modal-close" bindtap="hideRegisterForm">✕</text>
      </view>
      <view class="modal-body">
        <view class="input-group">
          <input class="form-input" type="text" placeholder="请输入用户名" 
                 value="{{registerForm.username}}" 
                 data-field="username" 
                 bindinput="onRegisterInput" />
        </view>
        <view class="input-group">
          <input class="form-input" type="text" placeholder="请输入昵称" 
                 value="{{registerForm.nickname}}" 
                 data-field="nickname" 
                 bindinput="onRegisterInput" />
        </view>
        <view class="input-group">
          <input class="form-input" type="text" placeholder="手机号（可选）" 
                 value="{{registerForm.phone}}" 
                 data-field="phone" 
                 bindinput="onRegisterInput" />
        </view>
        <view class="input-group">
          <input class="form-input" type="password" placeholder="请输入密码" 
                 value="{{registerForm.password}}" 
                 data-field="password" 
                 bindinput="onRegisterInput" />
        </view>
        <view class="input-group">
          <input class="form-input" type="password" placeholder="确认密码" 
                 value="{{registerForm.confirmPassword}}" 
                 data-field="confirmPassword" 
                 bindinput="onRegisterInput" />
        </view>
        <button class="submit-btn" bindtap="submitRegister" disabled="{{loading}}">
          {{loading ? '注册中...' : '注册'}}
        </button>
      </view>
    </view>
  </view>
</view>