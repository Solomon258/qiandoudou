<!--pages/login/login.wxml-->
<view class="container">
  <!-- 授权面板 - 保留代码但不再通过微信登录触发 -->
  <view class="auth-panel" wx:if="{{showAuthPanel}}">
    <view class="auth-content">
      <view class="logo-section">
        <view class="logo-icon">💰</view>
        <text class="logo-text">钱兜兜</text>
        <text class="logo-subtitle">和AI一起攒钱</text>
      </view>

      <view class="auth-title">设置你的昵称、头像</view>
      <view class="auth-desc">请设置您在钱兜兜的个人信息</view>

      <!-- 头像选择 -->
      <view class="avatar-section">
        <view class="avatar-preview">
          <image wx:if="{{tempAvatar}}" class="avatar-image" src="{{tempAvatar}}" mode="aspectFill" />
          <text wx:else class="avatar-placeholder">选择头像</text>
        </view>
        <button class="choose-avatar-btn" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">选择微信头像</button>
      </view>

      <!-- 昵称输入 -->
      <view class="nickname-section">
        <input class="nickname-input" type="nickname" placeholder="请输入昵称" value="{{tempNickname}}"
          bind:input="onNicknameInput" />
      </view>

      <view class="auth-buttons">
        <button class="auth-btn-primary" bindtap="handleSaveProfile"
          disabled="{{!tempAvatar || !tempNickname}}">完成设置</button>
        <button class="auth-btn-secondary" bindtap="handleManualSetup">跳过</button>
      </view>
    </view>
  </view>

  <!-- 新登录页面 -->
  <view class="login-page" wx:if="{{!showAuthPanel}}">
    <!-- 背景装饰 -->
    <!-- <view class="bg-decoration">
      <image class="bg-image" src="/static/login/登录/assets/位图.png" mode="aspectFill"></image>
    </view> -->

    <!-- 主登录区域 -->
    <view class="login-main">
      <!-- Logo区域 -->
      <view class="logo-area">
        <!-- <view class="logo-icon">💰</view>
        <text class="app-name">钱兜兜</text>
        <text class="app-slogan">和AI一起攒钱</text> -->
        <image class="baground-image" src="https://qiandoudou.oss-cn-guangzhou.aliyuncs.com/res/image/login_back.png" />
        <view class="login-hi">
          <text>您好，</text>
          <view class="login-hi-title">
            <text>欢迎使用钱兜兜</text>
          </view>
        </view>
      </view>

      <!-- 登录表单 -->
      <view class="login-form">
        <!-- 手机号输入 -->
        <view class="input-wrapper">
          <view class="input-box">
            <!-- <icon class="input-icon" type="search" size="16"></icon> -->
            <image class="input-icon" src="/static/icon/phone.svg"></image>
            <input class="phone-input" placeholder-class="my-placeholder" type="number" placeholder="请输入手机号"
              value="{{phoneNumber}}" maxlength="11" bindinput="onPhoneInput" />
          </view>
        </view>

        <!-- 验证码输入 -->
        <view class="input-wrapper">
          <view class="input-box verification-box">
            <image class="input-icon" src="/static/icon/shake.svg"></image>
            <input class="code-input" placeholder-class="my-placeholder" type="number" placeholder="请输入验证码"
              value="{{verificationCode}}" maxlength="6" bindinput="onCodeInput" />
            <button class="get-code-btn" bindtap="getVerificationCode"
              disabled="{{!isPhoneValid || codeCountdown > 0}}">
              {{codeCountdown > 0 ? codeCountdown + 's' : '获取验证码'}}
            </button>
          </view>
        </view>

        <!-- 登录按钮 -->
        <button class="login-btn" bindtap="handlePhoneLogin" disabled="{{!canLogin || loading}}">
          {{loading && loginType === 'phone' ? '登录中...' : '登录'}}
        </button>

        <!-- 微信登录按钮 -->
        <button class="login-btn wx" bindtap="handleWechatLogin" disabled="{{!agreeTerms || loading}}">
          <image class="wechat-icon" src="/static/icon/wx_logo.png"></image>
          <text class="wechat-text">{{loading && loginType === 'wechat' ? '登录中...' : '微信登录'}}</text>
        </button>
        <!-- 协议勾选 -->
        <view class="terms-section">
          <view class="terms-checkbox" bindtap="toggleAgreeTerms">
            <view class="checkbox {{agreeTerms ? 'checked' : ''}}">
              <text wx:if="{{agreeTerms}}" class="checkmark">✓</text>
            </view>
            <text class="terms-text">登录即注册并同意</text>
            <text class="terms-link" bindtap="showAgreement">《隐私政策》</text>
            <text class="terms-text" style="color: rgba(0,0,0,0.85);">及</text>
            <text class="terms-link" bindtap="showPrivacy">《用户协议》</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>