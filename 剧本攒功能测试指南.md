# 剧本攒功能测试指南

## 开发完成状态

### 后端功能 ✅
1. **数据库表结构**：
   - `scripts` 表已更新，支持分类、周期、每日金额、关注人数等字段
   - `script_chapters` 表已更新，支持视频URL字段
   - `user_script_progress` 表已创建，用于跟踪用户进度

2. **API接口**：
   - `GET /api/scripts` - 获取剧本列表（支持分类筛选）
   - `GET /api/scripts/{id}` - 获取剧本详情
   - `GET /api/scripts/{scriptId}/chapters/{chapterNumber}` - 获取章节内容
   - `POST /api/scripts/start` - 开始剧本
   - `POST /api/scripts/choice` - 处理用户选择和攒钱
   - `GET /api/scripts/progress` - 获取用户进度

3. **业务逻辑**：
   - 剧本进度管理
   - 选择驱动的剧情推进
   - 与钱包系统集成的攒钱功能

### 前端功能 ✅
1. **页面结构**：
   - 剧本列表页：显示推荐剧本，支持分类筛选
   - 剧本详情页：章节内容展示，选择交互，章节选择器

2. **交互逻辑**：
   - 章节解锁机制
   - 选择选项交互
   - 攒钱确认流程
   - 进度跟踪

3. **UI设计**：
   - 符合原型图的深色主题设计
   - 章节选择器（数字按钮）
   - 选择选项卡片
   - 底部转入按钮

## 测试步骤

### 1. 数据库初始化
请执行以下SQL脚本：
```bash
# 在数据库中执行
qiandoudou-backend/src/main/resources/sql/script_feature_update.sql
qiandoudou-backend/src/main/resources/sql/insert_script_data.sql
```

### 2. 启动后端服务
```bash
# 在qiandoudou-backend目录下
mvn spring-boot:run
```

### 3. 启动前端服务
```bash
# 在微信开发者工具中打开qiandoudou-frontend目录
```

### 4. 功能测试流程

#### 4.1 进入剧本攒功能
1. 在钱包详情页面，点击"剧本攒"按钮
2. 应该看到剧本列表页面，显示推荐的剧本

#### 4.2 选择剧本
1. 点击"超级玛丽多恋爱小事"剧本卡片
2. 进入剧本详情页面，应该看到：
   - 深色背景主题
   - 剧本标题和进度信息
   - 第1集的视频内容
   - 底部章节选择器（当前只有第1集可选）
   - 选择选项（A.星汉灿烂 ¥8.00 / B.星汉灿烂 ¥10.00）

#### 4.3 进行选择和攒钱
1. 点击选择一个选项（如"A.星汉灿烂"）
2. "向钱兜兜转入"按钮应该变为可点击状态
3. 点击转入按钮，确认攒钱
4. 成功后应该解锁第2集，章节选择器显示更多可用章节

#### 4.4 章节切换
1. 在章节选择器中点击已解锁的章节数字
2. 应该能正常切换到对应章节内容

## 预期效果

### 剧本列表页
- 显示"正在追"区域（如果有进行中的剧本）
- 显示推荐剧本网格，每个卡片显示关注人数标签
- 分类筛选功能正常

### 剧本详情页
- 深色主题，符合原型图设计
- 视频播放功能正常
- 章节选择器正确显示解锁状态
- 选择选项交互流畅
- 攒钱流程完整

## 注意事项

1. **视频路径**：视频文件应放在`qiandoudou-frontend/images/script/古风古情/`目录下
2. **用户登录**：确保用户已登录并有有效的钱包
3. **网络请求**：确保前端能正常访问后端API
4. **数据格式**：章节的choices字段是JSON格式，前端会自动解析

## 故障排查

如果遇到问题，请检查：
1. 数据库表是否正确创建和初始化
2. 后端服务是否正常启动
3. 前端API调用是否成功
4. 用户是否有足够的权限访问钱包功能
5. 视频文件路径是否正确
