# 剧本视频全屏功能修复指南

## 问题描述
剧本攒页面中，古风古情剧本的视频可以正常播放，但全屏按钮无法使用。

## 修复内容

### 1. 前端修复 (微信小程序)

#### WXML 修改 (`qiandoudou-frontend/pages/script-detail/script-detail.wxml`)
- 添加了 `bindfullscreenchange="onFullscreenChange"` 全屏状态变化事件
- 添加了 `bindtimeupdate="onTimeUpdate"` 时间更新事件
- 添加了更多视频事件绑定：
  - `bindpause="onVideoPause"` - 暂停事件
  - `bindended="onVideoEnded"` - 播放结束事件
  - `bindwaiting="onVideoWaiting"` - 缓冲事件
  - `bindprogress="onVideoProgress"` - 进度事件
- 优化了视频组件属性：
  - `direction="{{0}}"` - 设置默认方向
  - `show-progress="{{true}}"` - 显示进度条
  - `show-loading="{{true}}"` - 显示加载状态
  - `enable-progress-gesture="{{true}}"` - 启用进度手势

#### JavaScript 修改 (`qiandoudou-frontend/pages/script-detail/script-detail.js`)
- 添加了视频上下文管理：`videoContext` 和 `isFullscreen` 状态
- 添加了 `onReady()` 方法初始化视频上下文
- 实现了全屏事件处理方法：
  - `onFullscreenChange()` - 处理全屏状态变化
  - `requestFullscreen()` - 手动请求全屏
  - `exitFullscreen()` - 退出全屏
- 添加了更多视频事件处理：
  - `onVideoPause()` - 暂停事件处理
  - `onVideoEnded()` - 播放结束事件处理
  - `onVideoWaiting()` - 缓冲事件处理
  - `onVideoProgress()` - 进度事件处理
- 优化了视频 URL 处理，确保指向正确的后端静态资源服务

#### WXSS 修改 (`qiandoudou-frontend/pages/script-detail/script-detail.wxss`)
- 为视频组件添加了黑色背景：`background: #000`
- 添加了全屏状态的样式：`.chapter-video.fullscreen`

### 2. 后端修复 (Spring Boot)

#### 新增静态资源配置 (`qiandoudou-backend/src/main/java/com/qiandoudou/config/WebConfig.java`)
- 创建了 `WebMvcConfigurer` 配置类
- 配置了静态资源映射：
  - `/images/**` -> `file:./qiandoudou-frontend/images/`
  - `/uploads/**` -> `file:./uploads/`
- 确保视频文件可以通过 `http://localhost:8080/api/images/script/古风古情/寻佳缘.mp4` 访问

## 测试步骤

### 1. 启动服务
```bash
# 启动后端服务
cd qiandoudou-backend
mvn spring-boot:run

# 或使用批处理文件
start-backend.bat
```

### 2. 在微信开发者工具中测试
1. 打开微信开发者工具
2. 导入 `qiandoudou-frontend` 项目
3. 进入剧本攒页面
4. 点击"古风古情"剧本
5. 在视频播放界面点击全屏按钮
6. 验证全屏功能是否正常工作

### 3. 验证要点
- ✅ 视频能正常播放
- ✅ 全屏按钮可以点击
- ✅ 点击全屏按钮后视频进入全屏模式
- ✅ 可以正常退出全屏
- ✅ 全屏状态变化有相应的控制台日志

## 技术要点

### 微信小程序视频全屏的关键点：
1. **video 组件必须有唯一的 id**：用于创建视频上下文
2. **使用 wx.createVideoContext**：获取视频控制实例
3. **绑定 bindfullscreenchange 事件**：监听全屏状态变化
4. **正确的视频 URL**：确保视频文件可以访问
5. **适当的视频属性配置**：启用各种播放控制

### 静态资源服务配置：
1. **WebMvcConfigurer**：Spring Boot 静态资源映射
2. **路径映射**：将前端静态文件映射到后端 URL
3. **CORS 配置**：确保跨域访问正常

## 故障排除

如果全屏功能仍然不工作，检查：
1. 视频文件是否存在于 `qiandoudou-frontend/images/script/古风古情/` 目录
2. 后端服务是否正常启动
3. 静态资源映射是否生效：访问 `http://localhost:8080/api/images/script/古风古情/寻佳缘.mp4`
4. 微信开发者工具的控制台是否有错误信息
5. 网络请求是否成功

## 相关文件
- `qiandoudou-frontend/pages/script-detail/script-detail.wxml`
- `qiandoudou-frontend/pages/script-detail/script-detail.js`
- `qiandoudou-frontend/pages/script-detail/script-detail.wxss`
- `qiandoudou-backend/src/main/java/com/qiandoudou/config/WebConfig.java`
- `qiandoudou-backend/src/main/resources/sql/ancient_love_script.sql`
