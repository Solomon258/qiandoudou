# 头像设置功能测试指南

## 🎯 功能恢复完成

头像设置功能已成功恢复！现在可以测试完整的微信头像设置流程。

## 🧪 测试步骤

### 测试场景一：首次登录 + 选择使用微信头像

1. **清除小程序数据**
   ```
   微信开发者工具 -> 工具 -> 清缓存 -> 清除所有数据
   ```

2. **执行微信登录**
   - 点击"微信登录"按钮
   - 等待登录成功提示

3. **验证头像设置引导**
   - 应该弹出"设置头像"对话框
   - 内容："欢迎使用钱兜兜！是否使用您的微信头像作为个人头像？"
   - 两个选项："使用微信头像" 和 "稍后设置"

4. **选择"使用微信头像"**
   - 点击"使用微信头像"按钮
   - 应该跳转到头像设置页面（`/pages/edit-profile/edit-profile`）

5. **设置微信头像**
   - 页面应显示"使用微信头像"按钮（绿色渐变样式）
   - 点击"使用微信头像"按钮
   - 选择微信头像
   - 等待上传完成

6. **验证设置成功**
   - 应该弹出"设置成功"对话框
   - 点击"开始使用"跳转到首页
   - 在个人主页查看头像是否正确显示

### 测试场景二：首次登录 + 选择稍后设置

1. **重复步骤1-3**
2. **选择"稍后设置"**
   - 点击"稍后设置"按钮
   - 应该直接跳转到首页
   - 头像显示为默认头像

### 测试场景三：非首次登录

1. **使用已有头像的用户登录**
2. **验证直接跳转**
   - 不应该弹出头像设置引导
   - 直接跳转到首页
   - 显示用户原有头像

## 🔍 关键检查点

### 控制台输出
打开微信开发者工具控制台，应该看到：
```
微信登录成功 - 用户: 微信用户 首次登录: true
```
或
```
微信登录成功 - 用户: 昵称 首次登录: false
```

### 页面跳转
- 首次登录选择微信头像：`login -> edit-profile -> home`
- 首次登录选择稍后设置：`login -> home`
- 非首次登录：`login -> home`

### 头像显示
- 设置成功后在以下页面检查头像：
  - 兜圈圈个人主页（`user-social-profile`）
  - 社交页面（`social`）
  - 个人资料编辑页面（`edit-profile`）

## 📁 涉及的文件

### 前端文件
- `pages/login/login.js` - 微信登录和引导逻辑
- `pages/edit-profile/edit-profile.js` - 微信头像选择处理
- `pages/edit-profile/edit-profile.wxml` - 微信头像按钮
- `pages/edit-profile/edit-profile.wxss` - 按钮样式

### 后端接口
- `/auth/wechat-login` - 微信登录
- `/api/wallet/upload-user-image` - 头像上传到OSS
- `/auth/update-avatar` - 更新用户头像

## 🚨 可能遇到的问题

### 问题1: 头像按钮不显示
**原因**: 页面参数未正确传递
**解决**: 确认跳转URL包含 `firstLogin=true&setWechatAvatar=true`

### 问题2: 微信头像选择失败
**原因**: 微信API限制或权限问题
**解决**: 
- 确认在真机或微信开发者工具中测试
- 检查小程序权限配置

### 问题3: 头像上传失败
**原因**: OSS配置或网络问题
**解决**: 
- 检查后端OSS配置
- 查看控制台错误信息
- 验证网络连接

### 问题4: 页面跳转异常
**原因**: 页面路径错误或页面不存在
**解决**: 
- 确认页面路径正确
- 检查 `app.json` 中的页面配置

## 🎉 成功标志

当看到以下情况时，说明功能正常：

1. ✅ 首次登录弹出头像设置引导
2. ✅ 微信头像按钮显示且可点击
3. ✅ 头像选择和上传成功
4. ✅ 各页面头像显示一致
5. ✅ 非首次登录直接跳转首页

## 🔧 调试工具

如果遇到问题，可以：
1. 查看微信开发者工具控制台输出
2. 检查网络请求是否成功
3. 验证本地存储数据是否正确
4. 查看后端日志确认接口调用

测试愉快！🚀
