# 调试数据检查指南

## 🔍 问题排查步骤

当您点击"允许"后进入首页，但个人主页没有显示头像和昵称时，请按以下步骤检查：

### 1. 检查控制台日志

请提供点击"允许"后的完整控制台日志，特别是以下关键信息：
- `用户允许使用微信信息（模拟）`
- `开始上传微信资料:`
- `使用现有OSS头像，直接更新用户资料`
- `更新用户资料到后端:`
- `用户资料更新成功`
- `本地存储更新后的userInfo:`
- `全局数据更新后的userInfo:`

### 2. 手动检查本地存储

在微信开发者工具控制台中运行以下命令：

```javascript
// 检查本地存储的用户信息
console.log('本地存储userInfo:', wx.getStorageSync('userInfo'))

// 检查全局数据
const app = getApp()
console.log('全局数据userInfo:', app.globalData.userInfo)

// 检查token
console.log('token:', wx.getStorageSync('token'))
```

### 3. 检查数据库

运行以下SQL查询检查数据库中的用户信息：

```sql
-- 查看最新创建的用户信息
SELECT id, username, nickname, avatar, openid, create_time 
FROM users 
WHERE username LIKE 'wx_%' 
ORDER BY create_time DESC 
LIMIT 5;
```

### 4. 手动刷新个人主页

在个人主页中，尝试下拉刷新或者重新进入页面，看是否能加载到最新的用户信息。

### 5. 临时解决方案

如果数据确实已经更新但页面没有显示，可以在个人主页的控制台运行：

```javascript
// 强制刷新用户信息
const page = getCurrentPages()[getCurrentPages().length - 1]
if (page && page.loadUserInfoFromServer) {
  page.loadUserInfoFromServer()
}
```

## 🔧 可能的问题和解决方案

### 问题1: 后端更新失败
**症状**: 控制台显示"用户资料更新失败"
**检查**: 查看后端日志是否有错误
**解决**: 检查后端接口和数据库连接

### 问题2: 本地存储未更新
**症状**: 本地存储中的userInfo没有新的头像和昵称
**检查**: 查看updateUserProfile方法的执行日志
**解决**: 确认数据更新逻辑正确执行

### 问题3: 页面缓存问题
**症状**: 数据已更新但页面显示旧数据
**检查**: 个人主页的loadUserInfo方法是否正确执行
**解决**: 重新进入页面或手动刷新

### 问题4: ID不匹配
**症状**: 用户ID不正确导致更新错误的用户
**检查**: 确认传递给updateProfile的userId是否正确
**解决**: 检查登录时保存的用户ID

## 📋 预期的正确数据结构

### 本地存储 (wx.getStorageSync('userInfo'))
```javascript
{
  id: "1966034476668813314",
  username: "wx_1757574121052", 
  nickname: "测试用户",  // 应该不再是"微信用户"
  avatar: "https://qiandoudou.oss-cn-guangzhou.aliyuncs.com/res/image/usages/user-avatar.png",
  hasCustomAvatar: true
}
```

### 数据库 (users表)
```sql
id: 1966034476668813314
username: wx_1757574121052
nickname: 测试用户
avatar: https://qiandoudou.oss-cn-guangzhou.aliyuncs.com/res/image/usages/user-avatar.png
```

请按照上述步骤检查，并提供相关的日志信息，我会根据具体情况进一步调试。
