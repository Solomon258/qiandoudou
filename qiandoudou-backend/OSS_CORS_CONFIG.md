# 阿里云OSS CORS配置说明

## 问题描述
微信小程序无法播放OSS上的音频文件，这是因为跨域资源共享(CORS)配置不正确导致的。

## 解决方案

### 1. 登录阿里云OSS控制台
1. 访问 https://oss.console.aliyun.com/
2. 选择您的Bucket：`qiandoudou`

### 2. 配置CORS规则
在Bucket管理页面，按以下步骤操作：

1. 点击左侧菜单 **"权限管理"** → **"跨域设置"**
2. 点击 **"设置"** 按钮
3. 点击 **"创建规则"** 添加新的CORS规则

### 3. CORS规则配置
请添加以下CORS规则：

```
来源(Origin): *
允许Methods: GET, POST, PUT, DELETE, HEAD
允许Headers: *
暴露Headers: ETag, x-oss-request-id
缓存时间(秒): 0
```

**详细配置说明：**
- **来源(Origin)**: `*` (允许所有域名访问，包括微信小程序)
- **允许Methods**: `GET, POST, PUT, DELETE, HEAD`
- **允许Headers**: `*` (允许所有请求头)
- **暴露Headers**: `ETag, x-oss-request-id`
- **缓存时间**: `0` (不缓存预检请求)

### 4. 针对微信小程序的特殊配置
如果您只想允许微信小程序访问，可以将来源设置为：
```
https://servicewechat.com
```

### 5. Bucket权限设置
确保您的Bucket权限设置为：
- **读写权限**: 公共读 (允许匿名用户读取文件)
- **防盗链**: 可以设置空Referer访问(微信小程序需要)

### 6. 验证配置
配置完成后，可以通过以下方式验证：

1. **浏览器测试**: 直接在浏览器中访问音频文件URL
2. **微信开发者工具**: 在小程序中测试音频播放功能
3. **网络面板**: 检查是否有CORS相关错误

### 7. 常见问题排查

#### 问题1: 仍然无法播放
- 检查音频文件URL是否正确
- 确认文件确实存在于OSS中
- 检查文件的Content-Type是否正确设置

#### 问题2: 间歇性播放失败
- 检查OSS的访问频率限制
- 确认网络连接稳定性

#### 问题3: 特定设备无法播放
- 检查音频格式兼容性
- 确认设备支持的音频编码

## 音频格式建议
- **推荐格式**: WAV, MP3
- **编码**: PCM (WAV), MP3
- **采样率**: 16kHz 或 44.1kHz
- **位深度**: 16bit

## 注意事项
1. CORS配置修改后可能需要几分钟才能生效
2. 建议定期检查OSS的访问日志，确认是否有异常访问
3. 如果是生产环境，建议设置更精确的Origin而不是使用通配符`*`
