# 🎨 钱包背景更新测试指南

## 🔧 已修复的问题

### 后端数据查询优化
- 修改了 `WalletMapper.getUserWalletsWithPartner()` 方法
- 明确指定了 `background_image as backgroundImage` 字段映射
- 确保后端返回正确的背景字段

### 前端背景处理增强
- 更新了首页的 `getWalletBackground()` 方法
- 支持自定义图片背景（`custom_bg_` 开头）
- 支持网络图片和本地路径背景
- 添加了详细的调试日志

### 页面刷新机制改进
- 优化了钱包详情页的刷新通知逻辑
- 确保背景更换后立即刷新首页钱包列表

## 🧪 测试步骤

### 1. 重新启动后端
后端正在重新启动以应用Mapper更改，请等待启动完成。

### 2. 测试背景更换功能
1. **登录应用**：使用 `demo_user` / `123456`
2. **进入钱包详情页**：点击任意钱包
3. **更换背景**：
   - 点击"更换背景"按钮
   - 选择不同的渐变背景（如 gradient3、gradient4）
   - 点击"保存"
4. **验证更新**：
   - 返回首页
   - 检查钱包卡片背景是否立即更新
   - 查看控制台日志，应该显示背景字段和样式信息

### 3. 测试自定义图片背景
1. **上传图片**：在背景选择中选择"从相册选择图片"
2. **保存背景**：确认保存自定义背景
3. **验证显示**：返回首页查看效果

## 🐛 调试信息

如果背景仍然不更新，请查看控制台输出：
- `处理钱包背景 - 钱包数据:` - 查看后端返回的钱包数据
- `钱包背景字段:` - 查看backgroundImage字段的值
- `生成的背景样式:` - 查看最终生成的CSS样式

## 📝 预期结果

- ✅ 更换背景后立即在列表页生效
- ✅ 控制台显示正确的背景字段数据
- ✅ 支持预设渐变和自定义图片背景
- ✅ 数据持久化到数据库

## 🔄 如果仍有问题

如果背景更新仍然不工作，请：
1. 查看控制台的调试日志
2. 确认后端返回的 `backgroundImage` 字段值
3. 检查首页是否正确调用了刷新方法

等待后端启动完成后即可开始测试！



